<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><title></title><script src="lib/zepto.min.js"></script><script>function CacheItem(e,t){var a=(new Date).getTime();this.c=a,t=t||_defaultExpire,this.e=a+1e3*t,this.v=e}function _isCacheItem(e){return"object"==typeof e&&!!(e&&"c"in e&&"e"in e&&"v"in e)}function _checkCacheItemIfEffective(e){return(new Date).getTime()<e.e}function getQueryValue(e){var t=location.search,a=new Array;if(t.length>1){var i=t.indexOf("?");t=t.substring(i+1,t.length)}else t=null;if(t)for(var r=0;r<t.split("&").length;r++)a[r]=t.split("&")[r];for(var n=0;n<a.length;n++)if(a[n].split("=")[0]==e)return decodeURI(a[n].split("=")[1]);return""}$(function(){var e=getQueryValue("auth_token");page=getQueryValue("state"),code=getQueryValue("code"),weChat_user=Storage.getCache(Storage.AUTH),weChat_user||""!=code?""!=code&&""==e?window.location="html/bind.html?auth_token="+e+"&code="+code:window.location="html/"+page+".html?auth_token="+e+"&code="+code:$.ajax({url:config.km_api+"api/v1/wx/mp/oauth2/build_authorize_url",data:{app_key:config.key,auth_token:"",state:getQueryValue("state")},type:"GET",dataType:"jsonp",xhrFields:{withCredentials:!0},jsonpCallback:"jsonp"+Math.ceil(1e3*Math.random()),success:function(e){window.location=e.data.url}})});var config={key:"29817749",km_api:"http://test.kuaima.cn/km_task/"},_maxExpireDate=new Date("Fri, 31 Dec 9999 23:59:59 UTC"),_defaultExpire=_maxExpireDate.getTime(),handleJSON={serialize:function(e){return JSON.stringify(e)},deserialize:function(e){return e&&JSON.parse(e)}},Storage={AUTH:"KMAUTH",get:function(e,t){if(this.isLocalStorage()){var a=this.getStorage(t).getItem(e);return a?JSON.parse(a):void 0}},set:function(e,t,a){this.isLocalStorage()&&(t=JSON.stringify(t),this.getStorage(a).setItem(e,t))},remove:function(e,t){this.isLocalStorage()&&this.getStorage(t).removeItem(e)},setCache:function(e,t,a,i){if(this.isLocalStorage()){var r=new CacheItem(t,a);this.getStorage(i).setItem(e,handleJSON.serialize(r))}},getCache:function(e,t){var a=null;try{var i=this.getStorage(t).getItem(e);a=handleJSON.deserialize(i)}catch(e){return null}if(_isCacheItem(a)){if(_checkCacheItemIfEffective(a)){return i=a.v}return this.remove(e),null}return null},getStorage:function(e){return e?sessionStorage:localStorage},isLocalStorage:function(){try{return!!window.localStorage||(console.log("不支持本地存储"),!1)}catch(e){return console.log("本地存储已关闭"),!1}}};window.Storage=Storage</script></head><body></body></html>