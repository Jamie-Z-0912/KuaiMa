define("app/bindAward",["../mod/base"],function(require,exports,module){require("../mod/base")}),define("mod/base",["zepto","./tools","./storageCache"],function(require,exports,module){function t(t,e){var a=t,o={"M+":a.getMonth()+1,"d+":a.getDate(),"h+":a.getHours(),"m+":a.getMinutes(),"s+":a.getSeconds(),"q+":Math.floor((a.getMonth()+3)/3),S:a.getMilliseconds()};/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(a.getFullYear()+"").substr(4-RegExp.$1.length)));for(var i in o)new RegExp("("+i+")").test(e)&&(e=e.replace(RegExp.$1,1==RegExp.$1.length?o[i]:("00"+o[i]).substr((""+o[i]).length)));return e}function e(){var t=window.location.pathname.split(".html")[0],e=t.split("/");$.ajax({url:i.km_api+"api/v1/wx/mp/oauth2/build_authorize_url",data:{app_key:i.key,auth_token:Tools.auth_token(),state:e[e.length-1]},type:"GET",dataType:"jsonp",xhrFields:{withCredentials:!0},jsonpCallback:"jsonp"+Math.ceil(1e3*Math.random()),success:function(t){window.location=t.data.url}})}function a(){return n.user?n.user:Tools.auth_token()?(n.setAuth(Tools.auth_token()),Tools.auth_token()):void e()}function o(t){var a,o=function(){};if(!t.status)return void Tools.alertDialog({title:"出错了",text:"没有返回status"});if(/1001|1002|1003|1009|1101|1015/.test(t.status))a={title:"提醒",text:t.desc};else{if(!/1006/.test(t.status))return/1004|1013/.test(t.status)?(e(),!1):(a=null,!0);var i=5;a={title:"提醒",text:"访问太过频繁，<span id='closeTimer'>"+i+"</span>s后自动刷新"};var n=setInterval(function(){i--,i<1&&(clearInterval(n),window.location.reload()),$("#closeTimer").text(i)},1e3)}return null!=a?(Tools.alertDialog(a,o),!1):void 0}var $=require("zepto");require("./tools"),require("./storageCache");var i={key:"29817749",km_api:server+"km_task/"},n={user:Storage.getCache(Storage.AUTH),setAuth:function(t){Storage.setCache(Storage.AUTH,t,259200)}};module.exports={checkAccredit:a,formatDate:function(e,a){var o=a||"yyyy-MM-dd hh:mm";if(isNaN(e)||null==e)return e;if("object"==typeof e){var i=dd.getFullYear(),n=dd.getMonth()+1,s=dd.getDate();n<10&&(n="0"+n);var r=i+"-"+n+"-"+s,l=r.match(/(\d+)/g),u=new Date(l[0],l[1]-1,l[2]);return t(u,o)}var u=new Date(parseInt(e));return t(u,o)},baseAjax:function(t,e){var n=(navigator.userAgent,i.key),s=a(),r={name:"app_key",value:n};t.showLoading&&(0==$(".ui-loading-block").length?$("body").append('<div class="ui-loading-block km-dialog show"><div class="ui-loading-cnt"><i class="ui-loading-bright"></i><p>加载中……</p></div></div>'):$(".ui-loading-block").addClass("show")),t.data||(t.data={}),$.isFunction(t.data.push)?t.data.push(r):t.data.app_key=n,$.isFunction(t.data.push)?t.data.push({name:"auth_token",value:s}):t.data.auth_token=s,$.ajax({url:i.km_api+t.url,data:t.data,type:"GET",dataType:"jsonp",xhrFields:{withCredentials:!0},jsonpCallback:"jsonp"+Math.ceil(1e3*Math.random()),success:function(a){t.showLoading&&$(".ui-loading-block").removeClass("show"),o(a)&&e(a)},error:function(e,a,o){console.log(e),t.showLoading&&$(".ui-loading-block").removeClass("show")}})},custom:function(t,e){var a=this;t=t||{},a.baseAjax(t,e)}}}),define("mod/tools",[],function(require){var t={getQueryValue:function(t){var e=location.search,a=new Array;if(e.length>1){var o=e.indexOf("?");e=e.substring(o+1,e.length)}else e=null;if(e)for(var i=0;i<e.split("&").length;i++)a[i]=e.split("&")[i];for(var n=0;n<a.length;n++)if(a[n].split("=")[0]==t)return decodeURI(a[n].split("=")[1]);return""},auth_token:function(){return t.getQueryValue("auth_token")},alertDialog:function(t,e){var a={title:null,text:null,img:null,time:3e3};for(var o in a)t[o]=t[o]||a[o];var i="tips"+(new Date).getTime(),n='<div id="'+i+'" class="ui-popup-screen km-dialog"><div class="ui-overlay-shadow km-popup">';t.time<1&&(n+='<i class="iconfont icon-close" id="close"></i>'),n+='<div class="content">',null!=t.title&&""!=t.title&&(n+="<h1>"+t.title+"</h1>"),null!=t.text&&""!=t.text&&(n+="<p>"+t.text+"</p>"),null!=t.img&&""!=t.img&&(n+='<div class="pic"><img src="'+t.img+'"/></div>'),n+="</div> </div> </div>";var s=$(n).appendTo("body"),r=$("#"+i+" .km-popup").height(),l=$(window).height(),u=(l-r)/2;if($("#"+i+" .km-popup").css("top",u),s.addClass("show-dialog"),$("#close").click(function(){$("#"+i).remove(),$.isFunction(e)&&e()}),t.time>0){var c=t.time;setTimeout(function(){$("#"+i).remove(),$.isFunction(e)&&e()},c)}}};window.Tools=t}),define("mod/storageCache",[],function(){function t(t,e){var a=(new Date).getTime();this.c=a,e=e||i,this.e=a+1e3*e,this.v=t}function e(t){return"object"==typeof t&&!!(t&&"c"in t&&"e"in t&&"v"in t)}function a(t){return(new Date).getTime()<t.e}var o=new Date("Fri, 31 Dec 9999 23:59:59 UTC"),i=o.getTime(),n={serialize:function(t){return JSON.stringify(t)},deserialize:function(t){return t&&JSON.parse(t)}},s={AUTH:"KMAUTH",get:function(t,e){if(this.isLocalStorage()){var a=this.getStorage(e).getItem(t);return a?JSON.parse(a):void 0}},set:function(t,e,a){this.isLocalStorage()&&(e=JSON.stringify(e),this.getStorage(a).setItem(t,e))},remove:function(t,e){this.isLocalStorage()&&this.getStorage(e).removeItem(t)},setCache:function(e,a,o,i){if(this.isLocalStorage()){var s=new t(a,o);this.getStorage(i).setItem(e,n.serialize(s))}},getCache:function(t,o){var i=null;try{var s=this.getStorage(o).getItem(t);i=n.deserialize(s)}catch(t){return null}if(e(i)){if(a(i)){var s=i.v;return s}return this.remove(t),null}return null},getStorage:function(t){return t?sessionStorage:localStorage},isLocalStorage:function(){try{return!!window.localStorage||(console.log("不支持本地存储"),!1)}catch(t){return console.log("本地存储已关闭"),!1}}};window.Storage=s});