<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"> 
    <meta name="format-detection" content="telephone=no">
    <meta http-equiv="pragma" content="no-cache">
    <meta http-equiv="cache-control" content="no-cache">
    <meta http-equiv="expires" content="0">
    <title>系统通知</title>
    <meta content='/favicon.ico' itemprop='image' property='og:image' />
    <link rel="stylesheet" href="assets/css/messageSys.css">
</head>
<body>
    <div class="max-w-750">
        <div id="conList" class="message-wrap"> </div>
        <div class="hide" id="listPage" class="hide"></div>
        <script id="conList-tmpl" type="text/x-dot-template">
        {{? it.status == 1020 }}
            <div class="empty">
                <img src="img/empty.png"><p>暂时没有消息</p>
            </div>
        {{??}}
            {{~it.data:value:index}}
                <a class="box" data-type="{{=value.msg_type}}"{{?value.action!=''}} href='{{=value.action}}'{{?}}>
                    <h2>{{=value.extra_content.nick}}</h2>
                    <div class="msg-con">
                        {{=value.msg}}
                    </div>
                    <div class="msg-bottom">
                        {{?value.action!=''}}<span class="msg-link">查看详情</span>{{?}}
                        <i class="iconfont ui-arrowlink"></i>
                    </div>
                    <div class="msg-time"><span>{{=value.added_time}}</span></div>
                </a>
            {{~}}
        {{?}}
        </script>
    </div>
    <script src="assets/scripts/seajs/sea.js" id="seajsnode"></script>
    <script>
        // window.jQuery = window.Zepto;
        function isToday(t){
            var curY = new Date().getFullYear(), 
                curM = new Date().getMonth() + 1, 
                curD = new Date().getDate();
            var day = t.split(' ')[0], time = t.split(' ')[1];
            day = day.split('-');
            if(day[0] == curY && day[1] == curM && day[2] == curD){
                return '今天 ' + time;
            }else{
                return t;
            }
        }
        seajs.use("./assets/scripts/libs/pagelist", function(pagelist) {
            pagelist.fun({ 
                url: 'api/v1/systemMsgs',
                data:{ page: 1, page_size: 20} 
            },function(d){
                if(d.page == 1){
                    for (var i = 0; i < d.data.length; i++) {
                        if(isToday(d.data[i].added_time) == d.data[i].added_time){
                            break;
                        }else{
                            d.data[i].added_time = isToday(d.data[i].added_time);
                        }
                    }
                }
            });
        });
    </script>
    <i id="lDom"></i>
</body>
</html>