define("app/51activity",["../mod/base","../plugs/tipsAd.js"],function(require,exports,module){var e=require("../mod/base"),t=require("../plugs/tipsAd.js");e.custom({url:"api/v1/activity/info",data:{activityId:1}},function(a){if(9500==a.status||9502==a.status)return void new t({type:"activityOver",title:"活动结束啦",text:'<p class="rec_over">感谢您对我们的支持，请您继续关注我们其他的活动。</p>',hasAd:"0",isClose:"no",btnType:"1"});if(1013==a.status)return void Tools.alertDialog({text:"账号异常，请联系客服",time:"0"});if(1e3==a.status){var i=a.data,n=i.activity;if($("#activityImg").html('<img src="'+n.image+'" />'),i.is_start){var o=i.todayReadArticleNum||0;o=o>i.everyDayNeedReadArticleNum?i.everyDayNeedReadArticleNum:o,$("#cur").text(o+"/"+i.everyDayNeedReadArticleNum),o==i.everyDayNeedReadArticleNum&&$("#todayStatus").html('<div class="tip">今日活跃已完成</div>')}else $("#todayStatus").html('<div class="tip">活动未开始，敬请关注</div>').prev().hide();$("#desc").text(n.desc),$("#ruleCon").text(n.rule);var r=i.readArticleDayNum/i.activityTotalDayNum*100;r=r.toFixed(5)+"%",$("#schCur").width(r);for(var s=[],l=0;l<n.rewards.length;l++){var d={};d.id=n.rewards[l].id,d.reward_name=n.rewards[l].reward_name,d.reward_num=n.rewards[l].reward_num,d.day=parseInt(n.rewards[l].reward_name.split("天")[0]),d.percent=(d.day/i.activityTotalDayNum*100).toFixed(5)+"%",d.can_receive=n.rewards[l].can_receive,d.had_receive=n.rewards[l].had_receive,s.push(d)}console.log(s),e.render("#treasureBox","#treasureBox-tmpl",s,void 0,!0),e.render("#reward","#reward-tmpl",s,void 0,!0);var c;c=1==r?"恭喜完成":"活跃"+i.readArticleDayNum+"天",$("#reward").append('<em style="left:'+r+'" class="curget">'+c+"</em>")}});Tools.uid();$("#treasureBox").on("click",".btn",function(){var a=$(this),i=a.data("id"),n=a.data("num");$(this).hasClass("ok")&&e.custom({url:"api/v1/activity/receiveReward",data:{activityId:1,rewardId:i}},function(e){return 9500==e.status||9502==e.status?void new t({type:"activityOver",title:"活动结束啦",text:'<p class="rec_over">感谢您对我们的支持，请您继续关注我们其他的活动。</p>',hasAd:"0",isClose:"no",btnType:"1"}):1013==e.status?void Tools.alertDialog({text:"账号异常，请联系客服",time:"0"}):9601==e.status?(Tools.alertDialog({text:"奖励已领取"}),void a.text("已领取").removeClass("ok")):9602==e.status?(Tools.alertDialog({text:"未达到活动奖励条件"}),void a.text("未达成").removeClass("ok")):void(1e3==e.status&&(new t({type:"receive",title:"恭喜您获得奖励",text:'<img src="./image/mycard.png" class="rec_img" /><p class="rec_red">'+n+'天阅读加速卡一张</p><p class="rec_gray">奖励已经发送至您的账户</p>',hasAd:"0",isClose:"no",btnType:"1"}),a.text("已领取").removeClass("ok")))})})}),define("mod/base",["zepto","../plugs/doT.min","./tools"],function(require,exports,module){function e(e,t){var a=e,i={"M+":a.getMonth()+1,"d+":a.getDate(),"h+":a.getHours(),"m+":a.getMinutes(),"s+":a.getSeconds(),"q+":Math.floor((a.getMonth()+3)/3),S:a.getMilliseconds()};/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(a.getFullYear()+"").substr(4-RegExp.$1.length)));for(var n in i)new RegExp("("+n+")").test(t)&&(t=t.replace(RegExp.$1,1==RegExp.$1.length?i[n]:("00"+i[n]).substr((""+i[n]).length)));return t}function t(e){var t,a=function(){};if(!e.status)return void Tools.alertDialog({title:"提醒",text:"系统错误，请稍后重试！"});switch(e.status){case 1101:t={title:"提醒",text:"请打开设置->通用->日期与时间校准您的系统时间"};break;case 1004:t={title:"提醒",text:"请在快马浏览器中登录再访问！"};break;case 1002:t={title:"提醒",text:"请在快马浏览器中访问！"};break;case 1006:var i=5;t={title:"提醒",text:"访问太过频繁，<span id='closeTimer'>"+i+"</span>s后自动刷新"};var n=setInterval(function(){i--,i<1&&(clearInterval(n),window.location.reload()),$("#closeTimer").text(i)},1e3);break;default:return t=null,!0}return null!=t?(Tools.alertDialog(t,a),!1):void 0}var $=require("zepto");var a=require("../plugs/doT.min"),i={key:"26817749",km_api:server+"km_task/"};require("./tools"),module.exports={formatDate:function(t,a){var i=a||"yyyy-MM-dd hh:mm";if(isNaN(t)||null==t)return t;if("object"==typeof t){var n=dd.getFullYear(),o=dd.getMonth()+1,r=dd.getDate();o<10&&(o="0"+o);var s=n+"-"+o+"-"+r,l=s.match(/(\d+)/g),d=new Date(l[0],l[1]-1,l[2]);return e(d,i)}var d=new Date(parseInt(t));return e(d,i)},baseAjax:function(e,a){var n={name:"app_key",value:i.key};e.showLoading&&(0==$(".ui-loading-block").length?$("body").append('<div class="ui-loading-block km-dialog show"><div class="ui-loading-cnt"><i class="ui-loading-bright"></i><p>加载中……</p></div></div>'):$(".ui-loading-block").addClass("show"),"paging"==e.logtype&&0!=e.data.skip||$(e.renderEle).hide()),e.data||(e.data={}),$.isFunction(e.data.push)?e.data.push(n):e.data.app_key=i.key,$.isFunction(e.data.push)?e.data.push({name:"auth_token",value:Tools.auth_token()}):e.data.auth_token=Tools.auth_token(),$.ajax({url:i.km_api+e.url,data:e.data,type:"GET",dataType:"jsonp",xhrFields:{withCredentials:!0},jsonpCallback:"jsonp"+Math.ceil(1e3*Math.random()),success:function(i){e.showLoading&&($(".ui-loading-block").removeClass("show"),"paging"==e.logtype&&0!=e.data.skip||$(e.renderEle).show()),t(i)&&a(i)},error:function(t,a,i){console.log(t),e.showLoading&&$(".ui-loading-block").removeClass("show"),"paging"!=e.logtype&&$(e.renderEle).show()}})},render:function(e,t,i,n,o){if($(t).length>0&&i){var r=n||void 0,s=$(t).text(),l=a.template(s,void 0,r);o?$(e).html(l(i)):$(e).append(l(i))}},custom:function(e,t){var a=this;e=e||{},e.logtype="custom",a.baseAjax(e,t)}}}),define("plugs/doT.min",[],function(require,exports,module){function e(t,a,i){return("string"==typeof a?a:a.toString()).replace(t.define||r,function(e,a,n,o){return 0===a.indexOf("def.")&&(a=a.substring(4)),a in i||(":"===n?(t.defineParams&&o.replace(t.defineParams,function(e,t,n){i[a]={arg:t,text:n}}),a in i||(i[a]=o)):new Function("def","def['"+a+"']="+o)(i)),""}).replace(t.use||r,function(a,n){t.useParams&&(n=n.replace(t.useParams,function(e,t,a,n){if(i[a]&&i[a].arg&&n)return e=(a+":"+n).replace(/'|\\/g,"_"),i.__exp=i.__exp||{},i.__exp[e]=i[a].text.replace(new RegExp("(^|[^\\w$])"+i[a].arg+"([^\\w$])","g"),"$1"+n+"$2"),t+"def.__exp['"+e+"']"}));var o=new Function("def","return "+n)(i);return o?e(t,o,i):o})}function t(e){return e.replace(/\\('|\\)/g,"$1").replace(/[\r\t\n]/g," ")}var a,i={version:"1.0.3",templateSettings:{evaluate:/\{\{([\s\S]+?(\}?)+)\}\}/g,interpolate:/\{\{=([\s\S]+?)\}\}/g,encode:/\{\{!([\s\S]+?)\}\}/g,use:/\{\{#([\s\S]+?)\}\}/g,useParams:/(^|[^\w$])def(?:\.|\[[\'\"])([\w$\.]+)(?:[\'\"]\])?\s*\:\s*([\w$\.]+|\"[^\"]+\"|\'[^\']+\'|\{[^\}]+\})/g,define:/\{\{##\s*([\w\.$]+)\s*(\:|=)([\s\S]+?)#\}\}/g,defineParams:/^\s*([\w$]+):([\s\S]+)/,conditional:/\{\{\?(\?)?\s*([\s\S]*?)\s*\}\}/g,iterate:/\{\{~\s*(?:\}\}|([\s\S]+?)\s*\:\s*([\w$]+)\s*(?:\:\s*([\w$]+))?\s*\}\})/g,varname:"it",strip:!0,append:!0,selfcontained:!1,doNotSkipEncoded:!1},template:void 0,compile:void 0};i.encodeHTMLSource=function(e){var t={"&":"&#38;","<":"&#60;",">":"&#62;",'"':"&#34;","'":"&#39;","/":"&#47;"},a=e?/[&<>"'\/]/g:/&(?!#?\w+;)|<|>|"|'|\//g;return function(e){return e?e.toString().replace(a,function(e){return t[e]||e}):""}},a=function(){return this||(0,eval)("this")}(),void 0!==module&&module.exports?module.exports=i:"function"==typeof define&&define.amd?define(function(){return i}):a.doT=i;var n={start:"'+(",end:")+'",startencode:"'+encodeHTML("},o={start:"';out+=(",end:");out+='",startencode:"';out+=encodeHTML("},r=/$^/;i.template=function(s,l,d){l=l||i.templateSettings;var c,u,p=l.append?n:o,v=0;s=l.use||l.define?e(l,s,d||{}):s,s=("var out='"+(l.strip?s.replace(/(^|\r|\n)\t* +| +\t*(\r|\n|$)/g," ").replace(/\r|\n|\t|\/\*[\s\S]*?\*\//g,""):s).replace(/'|\\/g,"\\$&").replace(l.interpolate||r,function(e,a){return p.start+t(a)+p.end}).replace(l.encode||r,function(e,a){return c=!0,p.startencode+t(a)+p.end}).replace(l.conditional||r,function(e,a,i){return a?i?"';}else if("+t(i)+"){out+='":"';}else{out+='":i?"';if("+t(i)+"){out+='":"';}out+='"}).replace(l.iterate||r,function(e,a,i,n){return a?(v+=1,u=n||"i"+v,a=t(a),"';var arr"+v+"="+a+";if(arr"+v+"){var "+i+","+u+"=-1,l"+v+"=arr"+v+".length-1;while("+u+"<l"+v+"){"+i+"=arr"+v+"["+u+"+=1];out+='"):"';} } out+='"}).replace(l.evaluate||r,function(e,a){return"';"+t(a)+"out+='"})+"';return out;").replace(/\n/g,"\\n").replace(/\t/g,"\\t").replace(/\r/g,"\\r").replace(/(\s|;|\}|^|\{)out\+='';/g,"$1").replace(/\+''/g,""),c&&(l.selfcontained||!a||a._encodeHTML||(a._encodeHTML=i.encodeHTMLSource(l.doNotSkipEncoded)),s="var encodeHTML = typeof _encodeHTML !== 'undefined' ? _encodeHTML : ("+i.encodeHTMLSource.toString()+"("+(l.doNotSkipEncoded||"")+"));"+s);try{return new Function(l.varname,s)}catch(e){throw"undefined"!=typeof console&&console.log("Could not create a template function: "+s),e}},i.compile=function(e,t){return i.template(e,null,t)},module.exports=i}),define("mod/tools",[],function(require){var e={getQueryValue:function(e){var t=location.search,a=new Array;if(t.length>1){var i=t.indexOf("?");t=t.substring(i+1,t.length)}else t=null;if(t)for(var n=0;n<t.split("&").length;n++)a[n]=t.split("&")[n];for(var o=0;o<a.length;o++)if(a[o].split("=")[0]==e)return decodeURI(a[o].split("=")[1]);return""},uid:function(){return this.getQueryValue("uid")||"null"},auth_token:function(){return this.getQueryValue("auth_token")||"null"},alertDialog:function(e,t){var a={title:null,text:null,img:null,time:3e3};for(var i in a)e[i]=e[i]||a[i];var n="tips"+(new Date).getTime(),o='<div id="'+n+'" class="ui-popup-screen km-dialog"><div class="ui-overlay-shadow km-popup">';e.time<1&&(o+='<i class="iconfont icon-close" id="close"></i>'),o+='<div class="content">',null!=e.title&&""!=e.title&&(o+="<h1>"+e.title+"</h1>"),null!=e.text&&""!=e.text&&(o+="<p>"+e.text+"</p>"),null!=e.img&&""!=e.img&&(o+='<div class="pic"><img src="'+e.img+'"/></div>'),o+="</div> </div> </div>";var r=$(o).appendTo("body"),s=$("#"+n+" .km-popup").height(),l=$(window).height(),d=(l-s)/2;if($("#"+n+" .km-popup").css("top",d),r.addClass("show-dialog"),$("#close").click(function(){$("#"+n).remove(),$.isFunction(t)&&t()}),e.time>0){var c=e.time;setTimeout(function(){$("#"+n).remove(),$.isFunction(t)&&t()},c)}}};window.Tools=e}),define("plugs/tipsAd",[],function(require,exports,module){var e=function(e){var t={isClose:"yes",type:"",title:"",subtit:"",text:"",btnType:"0",hasAd:"1",adImg:"image/ad.png",adLink:"school_invite_0.html"};this.option={};for(var a in t)this.option[a]=e[a]||t[a];this.id="pop_"+(new Date).getTime(),this.init()};e.prototype.init=function(e){var t=this,a=t.option,i=[];i.push('<div class="pop-mask km-dialog"></div>'),i.push('<div class="pop-screen km-dialog" id="'+t.id+'">'),i.push('<div class="box">'),"yes"==a.isClose&&i.push('<i class="iconfont icon-close"></i>'),i.push('<div class="hd-img '+a.type+'"></div>'),""!=a.title&&i.push("<h1>"+a.title+"</h1>"),""!=a.subtit&&i.push("<h3>"+a.subtit+"</h3>"),""!=a.text&&i.push('<div class="text">'+a.text+"</div>"),"1"==a.hasAd&&i.push('<div class="ad"><a href="'+a.adLink+'"><img src="'+a.adImg+'" /></a></div>'),"1"==a.btnType&&i.push('<div class="btnbox"><a class="close">我知道了</a></div>'),i.push("</div></div>"),$("body").append(i.join("")),$("#"+t.id).height($("#"+t.id+" .box").height()),$("#"+t.id+" .icon-close, #"+t.id+" .close").on("click",function(){t.close()})},e.prototype.close=function(){var e=$("#"+this.id);e.prev().remove(),e.remove()},module.exports=e});